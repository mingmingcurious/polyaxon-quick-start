version: 1.1
kind: compiled_operation
name: build-job
tags:
  - build-1

#查询算法定义的参数，全部罗列出来
inputs:
- {name: uuid, type: str, value: 123456, isOptional: true}
- {name: s3_con_name, type: str, value: s3-dbybucket-mlops, isOptional: true}
- {name: code_dir, type: str, value: algo/train/, isOptional: true}
- {name: boot_file, type: str, value: run.py, isOptional: true}
- {name: engine_image, type: str, value: polyaxon/polyaxon-examples:ml-serving, isOptional: true}
- {name: n_neighbors, type: int, isOptional: true, value: 3}
- {name: leaf_size, type: int, isOptional: true, value: 30}
- {name: metric, type: str, isOptional: true, value: minkowski}
- {name: p, type: int, isOptional: true, value: 2}
- {name: weights, type: str, isOptional: true, value: uniform}
- {name: test_size, type: float, isOptional: true, value: 0.3}
- {name: random_state, type: int, isOptional: true, value: 33}

outputs:
- {name: destination, type: image, value: polyaxon/flask-serving:1.0.0, isOptional: true, connection: registry-polyaxon}

run:
  kind: job
  environment:
    hostAliases:
      - hostnames:
          - image.io
        ip: 172.16.1.33
  connections:
    - registry-polyaxon
  init:
    - artifacts:
        files:
          - - dockerfile/Dockerfile
            - /plx-context/artifacts/Dockerfile
        dirs:
          - - flask-serving
            - /plx-context/artifacts/app
      connection: s3-dbybucket-mlops
  container:
    args:
      - '-c'
      - /plx-context/artifacts
      - '-d'
      - image.io/polyaxon/flask-serving:1.0.0
      - '--cache'
      - '--cache-ttl=6h'
      - ''
      - '--skip-tls-verify=true'
      - '--insecure=true'
    image: gcr.io/kaniko-project/executor:latest
    imagePullPolicy: IfNotPresent
    name: polyaxon-main